<main>
  <!-- Event Hero Section -->
  <section style="padding: 120px 0 80px; background: linear-gradient(135deg, var(--primary) 0%, #667eea 100%); color: white; position: relative; overflow: hidden;">
    <div class="container relative z-10">
      <!-- Event Type Badge -->
      <div class="mb-4">
        <span class="event-type-badge" style="background: rgba(255, 255, 255, 0.2); color: white; padding: 0.5rem 1rem; border-radius: 100px; font-size: 0.875rem; font-weight: 600;">
          {{ eventTypeEmoji }} {{ eventTypeLabel }}
        </span>
      </div>
      
      <!-- Event Title -->
      <h1 class="font-bold mb-6 animate-fade-in" style="font-family: 'Google Sans', sans-serif; font-size: clamp(2.5rem, 6vw, 4rem); line-height: 1.1;">
        {{ title }}
      </h1>
      
      <!-- Quick Info -->
      <div class="flex flex-wrap gap-6 mb-6" style="font-size: 1.125rem;">
        <div class="flex items-center gap-2">
          <span class="material-icons-round">schedule</span>
          <span id="eventDateTime">{{ date }}</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="material-icons-round">place</span>
          <span id="eventLocation">{{ location.venue }}</span>
        </div>
        {% if capacity %}
        <div class="flex items-center gap-2">
          <span class="material-icons-round">people</span>
          <span>{{ capacity }} spots</span>
        </div>
        {% endif %}
      </div>
      
      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-4">
        {% if registrationRequired and registrationLink %}
        <a href="{{ registrationLink }}" target="_blank" class="btn inline-flex items-center gap-2" style="background: white; color: var(--primary); padding: 1rem 2rem; font-size: 1.125rem; border-radius: 100px; font-weight: 600;">
          <span class="material-icons-round">how_to_reg</span>
          <span>Register Now</span>
        </a>
        {% endif %}
        
        <button id="addToCalendarBtn" class="btn inline-flex items-center gap-2" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; padding: 1rem 2rem; font-size: 1.125rem; border-radius: 100px; font-weight: 600;">
          <span class="material-icons-round">event</span>
          <span>Add to Calendar</span>
        </button>
        
        <button id="shareBtn" class="btn inline-flex items-center gap-2" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; padding: 1rem 2rem; font-size: 1.125rem; border-radius: 100px; font-weight: 600;">
          <span class="material-icons-round">share</span>
          <span>Share</span>
        </button>
      </div>
    </div>
    
    <!-- Decorative Background -->
    <div style="position: absolute; top: 0; right: 0; width: 50%; height: 100%; opacity: 0.1; background: radial-gradient(circle, white 1px, transparent 1px); background-size: 50px 50px;"></div>
  </section>
  
  <!-- Event Details Section -->
  <section style="padding: 80px 0;">
    <div class="container">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
        <!-- Main Content -->
        <div class="lg:col-span-2">
          <!-- Description -->
          <div class="mb-12">
            <h2 class="text-3xl font-bold mb-6" style="font-family: 'Google Sans', sans-serif; color: var(--text);">
              About This Event
            </h2>
            <div class="prose prose-lg" style="color: var(--text); line-height: 1.8;">
              {{ fullDescription or description }}
            </div>
          </div>
          
          <!-- Speakers -->
          {% if speakers and speakers.length > 0 %}
          <div class="mb-12">
            <h2 class="text-3xl font-bold mb-6" style="font-family: 'Google Sans', sans-serif; color: var(--text);">
              Speakers
            </h2>
            <div class="space-y-6">
              {% for speaker in speakers %}
              <div class="flex gap-4 p-6 rounded-xl" style="background: var(--bg-secondary);">
                {% if speaker.photoUrl %}
                <img src="{{ speaker.photoUrl }}" alt="{{ speaker.name }}" class="w-20 h-20 rounded-full object-cover">
                {% else %}
                <div class="w-20 h-20 rounded-full flex items-center justify-center" style="background: var(--primary); color: white; font-size: 2rem; font-weight: 600;">
                  {{ speaker.name[0] }}
                </div>
                {% endif %}
                <div>
                  <h3 class="text-xl font-bold mb-1" style="font-family: 'Google Sans', sans-serif; color: var(--text);">
                    {{ speaker.name }}
                  </h3>
                  <p class="mb-2" style="color: var(--primary); font-weight: 600;">
                    {{ speaker.title }}{% if speaker.company %} ‚Ä¢ {{ speaker.company }}{% endif %}
                  </p>
                  {% if speaker.bio %}
                  <p style="color: var(--text); opacity: 0.7;">{{ speaker.bio }}</p>
                  {% endif %}
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div>
          <!-- Event Info Card -->
          <div class="event-card sticky top-8">
            <div style="padding: 2rem;">
              <h3 class="text-xl font-bold mb-6" style="font-family: 'Google Sans', sans-serif; color: var(--text);">
                Event Information
              </h3>
              
              <div class="space-y-4">
                <!-- Date & Time -->
                <div>
                  <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons-round" style="color: var(--primary);">schedule</span>
                    <span class="font-semibold" style="color: var(--text);">Date & Time</span>
                  </div>
                  <p id="sidebarDateTime" style="color: var(--text); opacity: 0.7; padding-left: 2rem;">
                    {{ date }}
                  </p>
                </div>
                
                <!-- Location -->
                <div>
                  <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons-round" style="color: var(--primary);">place</span>
                    <span class="font-semibold" style="color: var(--text);">Location</span>
                  </div>
                  {% if location.isVirtual %}
                  <p style="color: var(--text); opacity: 0.7; padding-left: 2rem;">
                    üåê Virtual Event<br>
                    {% if location.virtualLink and registrationRequired == false %}
                    <a href="{{ location.virtualLink }}" target="_blank" style="color: var(--primary); text-decoration: underline;">Join Meeting</a>
                    {% else %}
                    Link provided after registration
                    {% endif %}
                  </p>
                  {% else %}
                  <p style="color: var(--text); opacity: 0.7; padding-left: 2rem;">
                    {{ location.venue }}<br>
                    {% if location.room %}{{ location.room }}<br>{% endif %}
                    {% if location.address %}{{ location.address }}{% endif %}
                  </p>
                  {% endif %}
                </div>
                
                <!-- Capacity -->
                {% if capacity %}
                <div>
                  <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons-round" style="color: var(--primary);">people</span>
                    <span class="font-semibold" style="color: var(--text);">Capacity</span>
                  </div>
                  <p style="color: var(--text); opacity: 0.7; padding-left: 2rem;">
                    {{ capacity }} attendees maximum
                  </p>
                </div>
                {% endif %}
                
                <!-- Tags -->
                {% if tags and tags.length > 0 %}
                <div>
                  <div class="flex items-center gap-2 mb-2">
                    <span class="material-icons-round" style="color: var(--primary);">label</span>
                    <span class="font-semibold" style="color: var(--text);">Topics</span>
                  </div>
                  <div class="flex flex-wrap gap-2" style="padding-left: 2rem;">
                    {% for tag in tags %}
                    <span style="background: var(--bg-secondary); color: var(--text); padding: 0.25rem 0.75rem; border-radius: 100px; font-size: 0.875rem;">
                      {{ tag }}
                    </span>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}
              </div>
              
              <div class="mt-8 pt-6" style="border-top: 1px solid var(--border);">
                <a href="/events/" class="flex items-center gap-2" style="color: var(--primary); font-weight: 600;">
                  <span class="material-icons-round">arrow_back</span>
                  <span>Back to All Events</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
  // Event data for calendar functionality
  const eventData = {
    title: {{ title | dump | safe }},
    description: {{ description | dump | safe }},
    location: {{ location | dump | safe }},
    date: {{ date | dump | safe }},
    endDate: {{ endDate | dump | safe }},
    eventType: {{ eventType | dump | safe }}
  };
  
  // Format date display
  function formatEventDate(dateString, endDateString) {
    const date = new Date(dateString);
    const options = {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: 'numeric',
      minute: '2-digit',
      timeZoneName: 'short'
    };
    
    let formatted = date.toLocaleDateString('en-US', options);
    
    if (endDateString) {
      const endDate = new Date(endDateString);
      const endTime = endDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
      formatted += ` - ${endTime}`;
    }
    
    return formatted;
  }
  
  // Update date displays
  document.addEventListener('DOMContentLoaded', function() {
    const formatted = formatEventDate(eventData.date, eventData.endDate);
    const dateTimeEl = document.getElementById('eventDateTime');
    const sidebarDateTimeEl = document.getElementById('sidebarDateTime');
    if (dateTimeEl) dateTimeEl.textContent = formatted;
    if (sidebarDateTimeEl) sidebarDateTimeEl.textContent = formatted;
  });
  
  // Add to Calendar functionality
  document.getElementById('addToCalendarBtn')?.addEventListener('click', function() {
    const startDate = new Date(eventData.date);
    const endDate = eventData.endDate ? new Date(eventData.endDate) : new Date(startDate.getTime() + 60 * 60 * 1000); // +1 hour default
    
    // Format dates for iCal
    const formatDate = (date) => {
      return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
    };
    
    const location = eventData.location.isVirtual 
      ? 'Virtual Event' 
      : `${eventData.location.venue || ''}${eventData.location.room ? ', ' + eventData.location.room : ''}`;
    
    // Create iCal format
    const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Job Club NJIT//Events//EN
BEGIN:VEVENT
UID:${Date.now()}@jobclub.njit.edu
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(startDate)}
DTEND:${formatDate(endDate)}
SUMMARY:${eventData.title}
DESCRIPTION:${eventData.description}
LOCATION:${location}
STATUS:CONFIRMED
END:VEVENT
END:VCALENDAR`;
    
    // Create download link
    const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = `${eventData.title.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.ics`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });
  
  // Share functionality
  document.getElementById('shareBtn')?.addEventListener('click', async function() {
    const shareData = {
      title: eventData.title,
      text: eventData.description,
      url: window.location.href
    };
    
    if (navigator.share) {
      try {
        await navigator.share(shareData);
      } catch (err) {
        console.log('Share cancelled or failed:', err);
      }
    } else {
      // Fallback: copy link
      navigator.clipboard.writeText(window.location.href).then(() => {
        alert('Event link copied to clipboard!');
      });
    }
  });
</script>

<style>
  .prose {
    max-width: none;
  }
  
  .prose p {
    margin-bottom: 1.25rem;
  }
  
  .prose ul, .prose ol {
    margin: 1.25rem 0;
    padding-left: 1.5rem;
  }
  
  .prose li {
    margin-bottom: 0.5rem;
  }
</style>
